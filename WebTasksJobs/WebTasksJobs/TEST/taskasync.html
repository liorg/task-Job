.<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Tasks Running Runtime</title>
    <link href="../Content/bootstrap.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Segoe UI', Arial, Helvetica, sans-serif;
            font-size: 16px;
        }

        #stockTable table {
            border-collapse: collapse;
        }

            #stockTable table th, #stockTable table td {
                padding: 2px 6px;
            }

            #stockTable table td {
                text-align: right;
            }

        #stockTable .loading td {
            text-align: left;
        }
    </style>
</head>
<body>
    
    <h1>Tasks Running Runtime</h1>
    <div id="disconnect">
        disconnect
    </div>
     <div id="err">
        err
    </div>
     <div id="reconnecting">
        reconnecting
    </div>  
    <div id="reconnected">
        reconnected
    </div>
    <div id="taskTable">
        <table border="1">
            <thead>
                <tr>
                    <th>TaskId</th>
                    <th>TaskName</th>
                    <th>Create Count</th>
                    <th>Sender Count</th>
                    <th>Failed Count</th>
                    <th>Count All</th>
                     <th>Is Running</th>
                </tr>
            </thead>
            <tbody>
                <tr class="loading">
                    <td colspan="5">loading...</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div>
        <button id="t1" value="1">start task 1</button>

         <button id="t2" value="2">start task 2</button>

         <button id="st1" value="1">stop task 1</button>

         <button id="st2" value="2">stop task 2</button>
    </div>

    <!--Script references. -->
    <!--Reference the jQuery library. -->
  <!--  <script src="../../Scripts/jquery-1.10.2.min.js"></script>

    <script src="../../Scripts/jquery.signalR-2.1.2.min.js"></script>-->
    <script src="../Scripts/jquery-1.9.1.min.js"></script>
    <script src="../Scripts/bootstrap.min.js"></script>
<!--        <script src="../../Scripts/jquery-1.6.4.min.js" ></script>-->
    <!--Reference the SignalR library. -->
    <script src="../../Scripts/jquery.signalR-2.1.2.min.js"></script>


    <!--Reference the autogenerated SignalR hub script. -->
    <script src="../../signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        // A simple templating method for replacing placeholders enclosed in curly braces.
        if (!String.prototype.supplant) {
            String.prototype.supplant = function (o) {
                return this.replace(/{([^{}]*)}/g,
                    function (a, b) {
                        var r = o[b];
                        return typeof r === 'string' || typeof r === 'number' ? r : a;
                    }
                );
            };
        }

        $(function () {
            $("#t1").click(function () {
                ticker.server.loadTask("{8F397C1B-5395-1111-1111-42BD4B4856AB}");
            });
            $("#t2").click(function () {
                ticker.server.loadTask("{8F397C1B-5395-2222-2222-42BD4B4856AB}");
            });

            $("#st1").click(function () {
                ticker.server.stopTask("{8F397C1B-5395-1111-1111-42BD4B4856AB}");
            });
            $("#st2").click(function () {
                ticker.server.stopTask("{8F397C1B-5395-2222-2222-42BD4B4856AB}");
            });
            //debugger
            var ticker = $.connection.tasksLongRunningAscyn; // the generated client-side hub proxy

            $stockTable = $('#taskTable');
            $stockTableBody = $stockTable.find('tbody');
            rowTemplate = '<tr data-symbol="{TaskId}"><td>{TaskId}</td><td>{TaskName}</td><td>{CreateCount}</td><td>{UpdateCount} </td><td>{FailedCount}</td><td>{CountAll}</td><td>{IsRunningS}</td></tr>';

            $.connection.hub.disconnected(function () {
                if ($.connection.hub.lastError) {
                    $("#err").text($.connection.hub.lastError.message);
                    // alert("Disconnected. Reason: " + $.connection.hub.lastError.message);
                }
                $("#disconnect").text("disconnected!!!!");
            });

            $.connection.hub.reconnecting(function () {
                $("#reconnecting").text("reconnecting!!!!");

            });

            $.connection.hub.reconnected(function () {
                $("#reconnected").text("reconnected!!!!");

            });

            function init() {
                ticker.server.getAllTasks().done(function (stocks) {
                    $stockTableBody.empty();
                    $.each(stocks, function () {
                        //var stock = formatStock(this);
                        $stockTableBody.append(rowTemplate.supplant(this));
                    });
                });
            }

            // Add a client-side hub method that the server will call
            ticker.client.updateJobCount = function (stock) {
                var displayStock = stock,
                    $row = $(rowTemplate.supplant(displayStock));

                $stockTableBody.find('tr[data-symbol=' + stock.TaskId + ']')
                    .replaceWith($row);
            }

            // Start the connection
            $.connection.hub.start().done(init);

        });

        </script>

</body>
</html>
